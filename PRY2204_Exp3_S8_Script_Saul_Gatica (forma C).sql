--  CREAR TABLAS


CREATE TABLE REGION (
    id_region NUMBER(2) PRIMARY KEY,
    nombre_region VARCHAR2(50) NOT NULL
);

CREATE TABLE COMUNA (
    id_comuna NUMBER(3) PRIMARY KEY,
    nombre_comuna VARCHAR2(50) NOT NULL,
    cod_region NUMBER(2),
    CONSTRAINT fk_comuna_region FOREIGN KEY (cod_region) REFERENCES REGION(id_region)
);

CREATE TABLE SALUD (
    id_salud NUMBER(5) PRIMARY KEY,
    nombre_salud VARCHAR2(40) NOT NULL
);

CREATE TABLE AFP (
    id_afp NUMBER(5) PRIMARY KEY,
    nombre_afp VARCHAR2(255) NOT NULL
);

CREATE TABLE MEDIO_PAGO (
    id_mpago NUMBER(3) PRIMARY KEY,
    nombre_mpago VARCHAR2(50) NOT NULL
);

CREATE TABLE CATEGORIA (
    id_categoria NUMBER(3) PRIMARY KEY,
    nombre_categoria VARCHAR2(255) UNIQUE
);

CREATE TABLE MARCA (
    id_marca NUMBER(3) PRIMARY KEY,
    nombre_marca VARCHAR2(25) UNIQUE
);

CREATE TABLE PROVEEDOR (
    id_proveedor NUMBER(4) PRIMARY KEY,
    nombre_proveedor VARCHAR2(50) NOT NULL
);

CREATE TABLE EMPLEADO (
    id_empleado NUMBER(4) PRIMARY KEY,
    rut_empleado VARCHAR2(10) UNIQUE,
    nombre_empleado VARCHAR2(25) NOT NULL,
    apellido_paterno VARCHAR2(25) NOT NULL,
    apellido_materno VARCHAR2(25),
    fecha_contratacion DATE NOT NULL,
    sueldo_base NUMBER(10) NOT NULL,
    bono_jefatura NUMBER(10),
    activo CHAR(1) CHECK (activo IN ('S','N')),
    tipo_empleado VARCHAR2(25) NOT NULL,
    cod_empleado NUMBER(4),
    cod_salud NUMBER(5),
    cod_afp NUMBER(5),
    CONSTRAINT fk_empleado_salud FOREIGN KEY (cod_salud) REFERENCES SALUD(id_salud),
    CONSTRAINT fk_empleado_afp FOREIGN KEY (cod_afp) REFERENCES AFP(id_afp),
    CONSTRAINT fk_empleado_jefe FOREIGN KEY (cod_empleado) REFERENCES EMPLEADO(id_empleado),
    CONSTRAINT ck_empleado_sueldo CHECK (sueldo_base >= 400000)
);

CREATE TABLE VENTA (
    id_venta NUMBER(4) GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    fecha_venta DATE DEFAULT SYSDATE NOT NULL,
    total_venta NUMBER(8,2),
    cod_mpago NUMBER(3),
    cod_empleado NUMBER(4),
    CONSTRAINT fk_venta_empleado FOREIGN KEY (cod_empleado) REFERENCES EMPLEADO(id_empleado),
    CONSTRAINT fk_venta_mediopago FOREIGN KEY (cod_mpago) REFERENCES MEDIO_PAGO(id_mpago)
);

CREATE TABLE PRODUCTO (
    id_producto NUMBER(4) PRIMARY KEY,
    nombre_producto VARCHAR2(50) NOT NULL,
    cod_categoria NUMBER(3),
    cod_marca NUMBER(3),
    precio NUMBER(10),
    cod_proveedor NUMBER(4),
    CONSTRAINT fk_producto_categoria FOREIGN KEY (cod_categoria) REFERENCES CATEGORIA(id_categoria),
    CONSTRAINT fk_producto_marca FOREIGN KEY (cod_marca) REFERENCES MARCA(id_marca),
    CONSTRAINT fk_producto_proveedor FOREIGN KEY (cod_proveedor) REFERENCES PROVEEDOR(id_proveedor)
);

CREATE TABLE DETALLE_VENTA (
    id_detalle NUMBER(4) PRIMARY KEY,
    cod_venta NUMBER(4),
    cod_producto NUMBER(4),
    cantidad NUMBER(5),
    CONSTRAINT fk_det_venta FOREIGN KEY (cod_venta) REFERENCES VENTA(id_venta),
    CONSTRAINT fk_det_producto FOREIGN KEY (cod_producto) REFERENCES PRODUCTO(id_producto)
);

CREATE TABLE VENDEDOR (
    id_empleado NUMBER(4) PRIMARY KEY,
    comision_venta NUMBER(5,2) CHECK (comision_venta BETWEEN 0 AND 0.25),
    CONSTRAINT fk_vendedor_empleado FOREIGN KEY (id_empleado) REFERENCES EMPLEADO(id_empleado)
);

CREATE TABLE ADMINISTRATIVO (
    id_empleado NUMBER(4) PRIMARY KEY,
    CONSTRAINT fk_admin_empleado FOREIGN KEY (id_empleado) REFERENCES EMPLEADO(id_empleado)
);


--  INSERTAR DATOS


-- REGIONES
INSERT INTO REGION VALUES (1, 'Metropolitana');
INSERT INTO REGION VALUES (2, 'Valparaíso');

-- COMUNAS
INSERT INTO COMUNA VALUES (1, 'Santiago', 1);
INSERT INTO COMUNA VALUES (2, 'Valparaíso', 2);

-- SALUD
INSERT INTO SALUD VALUES (2050, 'Fonasa');
INSERT INTO SALUD VALUES (2060, 'Isapre Cruz Blanca');
INSERT INTO SALUD VALUES (2070, 'Isapre Colmena');

-- AFP
INSERT INTO AFP VALUES (1,'AFP Habitat');
INSERT INTO AFP VALUES (2,'AFP Provida');
INSERT INTO AFP VALUES (3,'AFP Modelo');
INSERT INTO AFP VALUES (4,'AFP Capital');
INSERT INTO AFP VALUES (5,'AFP PlanVital');

-- MEDIO PAGO
INSERT INTO MEDIO_PAGO VALUES (1,'Efectivo');
INSERT INTO MEDIO_PAGO VALUES (2,'Tarjeta Débito');
INSERT INTO MEDIO_PAGO VALUES (3,'Tarjeta Crédito');

-- CATEGORIA
INSERT INTO CATEGORIA VALUES (1,'Electrónica');
INSERT INTO CATEGORIA VALUES (2,'Ropa');

-- MARCA
INSERT INTO MARCA VALUES (1,'Samsung');
INSERT INTO MARCA VALUES (2,'Nike');

-- PROVEEDOR
INSERT INTO PROVEEDOR VALUES (1,'Proveedor A');
INSERT INTO PROVEEDOR VALUES (2,'Proveedor B');

-- EMPLEADOS
INSERT INTO EMPLEADO VALUES (750,'11111111-1','Marcela','González','Pérez',DATE '2022-03-15',950000,80000,'S','Administrativo',NULL,2050,1);
INSERT INTO EMPLEADO VALUES (753,'22222222-2','José','Muñoz','Ramírez',DATE '2021-07-10',900000,75000,'S','Administrativo',NULL,2060,2);
INSERT INTO EMPLEADO VALUES (756,'33333333-3','Verónica','Soto','Alarcón',DATE '2020-01-05',880000,70000,'S','Vendedor',750,2060,3);
INSERT INTO EMPLEADO VALUES (757,'44444444-4','Carlos','Rojas','Diaz',DATE '2019-06-01',870000,65000,'S','Vendedor',753,2070,4);
INSERT INTO EMPLEADO VALUES (758,'55555555-5','Ana','Fuentes','García',DATE '2023-01-10',800000,NULL,'S','Administrativo',NULL,2050,2);

-- VENDEDORES
INSERT INTO VENDEDOR VALUES (756,0.15);
INSERT INTO VENDEDOR VALUES (757,0.10);

-- ADMINISTRATIVOS
INSERT INTO ADMINISTRATIVO VALUES (750);
INSERT INTO ADMINISTRATIVO VALUES (753);
INSERT INTO ADMINISTRATIVO VALUES (758);

-- PRODUCTOS
INSERT INTO PRODUCTO VALUES (1,'Smart TV 55"',1,1,500000,1);
INSERT INTO PRODUCTO VALUES (2,'Smartphone Galaxy S23',1,1,800000,1);
INSERT INTO PRODUCTO VALUES (3,'Zapatillas Nike Air',2,2,120000,2);
INSERT INTO PRODUCTO VALUES (4,'Camiseta Nike',2,2,25000,2);

-- VENTAS
INSERT INTO VENTA (total_venta,cod_mpago,cod_empleado) VALUES (600000,1,756);
INSERT INTO VENTA (total_venta,cod_mpago,cod_empleado) VALUES (145000,2,757);
INSERT INTO VENTA (total_venta,cod_mpago,cod_empleado) VALUES (250000,3,756);

-- DETALLE VENTA
INSERT INTO DETALLE_VENTA VALUES (1,1,1,1);
INSERT INTO DETALLE_VENTA VALUES (2,1,2,1);
INSERT INTO DETALLE_VENTA VALUES (3,2,3,1);
INSERT INTO DETALLE_VENTA VALUES (4,2,4,3);
INSERT INTO DETALLE_VENTA VALUES (5,3,2,1);
INSERT INTO DETALLE_VENTA VALUES (6,3,3,2);
